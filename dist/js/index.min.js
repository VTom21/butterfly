(()=>{function q(){document.querySelectorAll("break").forEach(e=>{let t=document.createElement("br");e.parentNode?.replaceChild(t,e)})}function C(e=2){document.querySelectorAll("extra-break").forEach(t=>{let r=document.createDocumentFragment();for(let o=0;o<e;o++){let n=document.createElement("br");r.appendChild(n)}t.parentNode?.replaceChild(r,t)})}function $(){document.querySelectorAll("custom-break").forEach(e=>{let t=document.createDocumentFragment(),r=parseInt(e.getAttribute("n")||"0");for(let o=0;o<r;o++){let n=document.createElement("br");t.appendChild(n)}e.parentNode?.replaceChild(t,e)})}function _(){document.querySelectorAll("divider").forEach(e=>{let t=document.createElement("hr");e.parentNode?.replaceChild(t,e)})}function O(){document.querySelectorAll("highlight").forEach(e=>{let t=document.createElement("strong");t.innerHTML=e.innerHTML,e.parentNode?.replaceChild(t,e)})}document.addEventListener("DOMContentLoaded",()=>{q(),C(),$(),_(),O()});var F=document.querySelectorAll("body *"),v=new WeakMap;document.querySelectorAll(".set").forEach(e=>{v.has(e)||v.set(e,{});let t=v.get(e);Array.from(e.attributes).forEach(r=>{let o=r.name,n=r.value;switch(o){case"thickness":e.style.borderWidth=`${n}px`;break;case"x-mult":t.scaleX=`scaleX(${n})`;break;case"y-mult":t.scaleY=`scaleY(${n})`;break;case"z-mult":t.scaleZ=`scaleZ(${n})`;break;case"mult":t.scale=`scale(${n})`;break;case"turn":t.rotate=`rotate(${n}deg)`;break;case"x-turn":t.rotateX=`rotateX(${n}deg)`;break;case"y-turn":t.rotateY=`rotateY(${n}deg)`;break;case"z-turn":t.rotateZ=`rotateZ(${n}deg)`;break;case"pointer":{let a={hand:"pointer",grab:"grab",cross:"crosshair",move:"move",script:"text",idle:"wait",basic:"default",abort:"not-allowed",query:"help",magnify_in:"zoom-in",magnify_out:"zoom-out",disabled:"none"};e.style.cursor=a[n]||n;break}case"blur":e.style.filter=`blur(${n})`;break;case"grayscale":e.style.filter=`grayscale(${n})`;break;case"light":e.style.filter=`brightness(${n})`;break;case"contrast":e.style.filter=`contrast(${n})`;break}}),e.style.transform=Object.values(t).join(" ")});document.querySelectorAll(".rainbow").forEach(e=>{let t=e.getAttribute("offset");t&&e.style.setProperty("--offset",t)});var k={"@click":"click","@dbclick":"dblclick","@m-down":"mousedown","@m-move":"mousemove","@m-over":"mouseover","@m-up":"mouseup","@m-out":"mouseout","@m-wheel":"wheel","@scroll":"scroll","@paste":"paste","@copy":"copy","@k-press":"keypress","@k-down":"keydown","@k-up":"keyup","@load":"load","@change":"change","@resize":"resize","@blur":"blur","@submit":"submit","@search":"search","@input":"input","@select":"select","@reset":"reset","@focus":"focus","@drag":"drag","@drag-end":"dragend","@drag-enter":"dragenter","@drag-leave":"dragleave","@drag-over":"dragover","@drag-start":"dragstart"},y={};for(let e in k){let t=k[e];y[t]||(y[t]=[]),y[t].push(e)}Object.keys(y).forEach(e=>{document.addEventListener(e,t=>{let r=t.target;for(;r&&r!==document;){for(let o of y[e]){let n=r.getAttribute(o);if(n){let a=window[n];typeof a=="function"?a.call(r,t):console.warn(`Handler "${n}" for "${o}" is not defined`);return}}r=r.parentElement}})});document.querySelectorAll("[\\@interlude]").forEach(e=>{let t=e.getAttribute("@interlude"),r=parseInt(e.getAttribute("@time"))||1e3,o=window[t];typeof o=="function"&&setInterval(()=>o.call(e),r)});document.querySelectorAll("[\\@halt]").forEach(e=>{let t=e.getAttribute("@halt"),r=parseInt(e.getAttribute("@time"))||1e3,o=window[t];typeof o=="function"&&setTimeout(()=>o.call(e),r)});document.querySelectorAll("[\\@countdown]").forEach(e=>{let t=e.getAttribute("@countdown"),r=window[t],o=parseInt(e.getAttribute("@tick"))||3e3;if(typeof r!="function"){console.warn(`Handler "${t}" for @countdown is not defined`);return}let n=o,a=100,i=e.textContent,s=setInterval(()=>{n-=a;let l=Math.ceil(n/1e3);e.textContent=i.replace("((countdown))",l),n<=0&&(clearInterval(s),e.textContent=i.replace("((countdown))",0),r.call(e))},a)});document.querySelectorAll("form").forEach(e=>{e.querySelectorAll("input, textarea").forEach(t=>{let r=t.getAttribute("@input-min"),o=t.getAttribute("@input-max"),n=r?parseInt(r):null,a=o?parseInt(o):null;t.dataset.validMin=n?"false":"true",t.dataset.validMax=a?"false":"true",t.addEventListener("input",()=>{let i=t.value.length;n&&i<n?t.dataset.validMin="false":t.dataset.validMin="true",a&&i>a?t.dataset.validMax="false":t.dataset.validMax="true"})}),e.addEventListener("submit",t=>{let r=e.querySelector("input[\\@input-min][data-valid-min='false'], textarea[\\@input-min][data-valid-min='false'], input[\\@input-max][data-valid-max='false'], textarea[\\@input-max][data-valid-max='false']");if(r){t.preventDefault();let o=r.getAttribute("@input-min"),n=r.getAttribute("@input-max"),a="Invalid input.";o&&r.dataset.validMin==="false"?a=`Please enter at least ${o} characters`:n&&r.dataset.validMax==="false"&&(a=`Please enter no more than ${n} characters`),alert(a),r.focus()}})});var D={letters:/^[a-zA-Z]+$/,numbers:/^[0-9]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,hex:/^[0-9a-fA-F]+$/,pass_special:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/,pass_simple:/^[\w!@#$%^&*()_+]{6,}$/,date:/^\d{4}-\d{2}-\d{2}$/,time:/^([01]\d|2[0-3]):([0-5]\d)$/,phone:/^\+?[0-9]{7,15}$/};document.querySelectorAll("input[\\@regex], textarea[\\@regex]").forEach(e=>{let t=e.getAttribute("@regex"),r=D[t];if(!r){console.warn(`Unknown @regex type: "${t}"`);return}e.dataset.validRegex="false",e.addEventListener("input",()=>{r.test(e.value)?e.dataset.validRegex="true":e.dataset.validRegex="false"})});document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",t=>{let r=e.querySelector("input[\\@regex][data-valid-regex='false'], textarea[\\@regex][data-valid-regex='false']");if(r){t.preventDefault();let o=r.getAttribute("@regex");alert(`Please enter valid ${o}`),r.focus()}})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[\\@toggle]").forEach(e=>{let t=e.getAttribute("@toggle").split(",").map(o=>o.trim()),r=e.getAttribute("@target")?e.getAttribute("@target").split(",").map(o=>o.trim()):[null];e.addEventListener("click",()=>{t.forEach((o,n)=>{let a=r[n]||r[r.length-1];(a?document.querySelectorAll(a):[e]).forEach(s=>{s&&s.classList.toggle(o)})})})})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[\\@resize]").forEach(e=>{let t=e.getAttribute("@resize");if(!t)return;let[r,o]=t.split(","),n=parseInt(r),a=parseInt(o);isNaN(n)||isNaN(a)||(document.body.style.width=n+"px",document.body.style.height=a+"px",document.documentElement.style.width=n+"px",document.documentElement.style.height=a+"px")})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[\\@log]").forEach(e=>{let t=e.getAttribute("@log"),r;if(t==="this"?r=e:t==="window"?r=window:t==="document"?r=document:r=document.querySelector(t),!r){console.warn(`@log target "${t}" not found`);return}r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement?console.log(r.value):r instanceof HTMLElement?console.log(r.textContent.trim()):console.log(r)})});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input[\\@trim], textarea[\\@trim]").forEach(e=>{e.addEventListener("input",()=>{let t=e.selectionStart;e.value=e.value.trim(),e.setSelectionRange(t,t)})})});var T={soft:/[<>]/g,strict:/[<>{}"'`;]/g};document.querySelectorAll("input[\\@sanitize], textarea[\\@sanitize]").forEach(e=>{let t=e.getAttribute("@sanitize")||"soft",r=T[t]||T.soft;e.addEventListener("input",()=>{e.value=e.value.replace(r,"")})});document.querySelectorAll("[\\@show]").forEach(e=>{e.style.visibility="visible"});document.querySelectorAll("[\\@hide]").forEach(e=>{e.style.visibility="hidden"});document.querySelectorAll("[\\@src]").forEach(e=>{let t=e.getAttribute("@src");t&&(e.setAttribute("src",t),e.removeAttribute("@src"))});document.querySelectorAll("[\\@fallback]").forEach(e=>{let t=e.getAttribute("@fallback");t&&(e.setAttribute("alt",t),e.removeAttribute("@fallback"))});document.querySelectorAll("[\\@link]").forEach(e=>{let t=e.getAttribute("@link");t&&(e.setAttribute("href",t),e.removeAttribute("@link"))});document.querySelectorAll("[\\@text]").forEach(e=>{let t=e.getAttribute("@text");t&&(e.innerHTML=t,e.removeAttribute("@text"))});document.querySelectorAll("[\\@placeholder]").forEach(e=>{let t=e.getAttribute("@placeholder");t&&("placeholder"in e?e.placeholder=t:e.setAttribute("placeholder",t),e.removeAttribute("@placeholder"))});document.querySelectorAll("[\\@compute]").forEach(e=>{let t=e.getAttribute("@compute");if(t){try{let o=new Function("Math",`return ${t};`)(Math);e.innerText+=o}catch(r){console.error("Error evaluating @compute:",t,r),e.innerText=""}e.removeAttribute("@compute")}});document.querySelectorAll("[\\@class]").forEach(e=>{let t=e.getAttribute("@class");t&&(e.className=t,e.removeAttribute("@class"))});document.querySelectorAll("[\\@id]").forEach(e=>{let t=e.getAttribute("@id");t&&(e.id=t,e.removeAttribute("@id"))});document.querySelectorAll("[\\@clip]").forEach(e=>{let t=e.getAttribute("\\@clip");e.addEventListener("click",async()=>{let r=e.textContent;if(t)try{r=new Function("Math","el",`return ${t};`)(Math,e)}catch(o){console.error("Error evaluating @clip:",t,o)}try{await navigator.clipboard.writeText(r),console.log("Copied to clipboard:",r)}catch(o){console.error("Clipboard copy failed:",o)}}),e.removeAttribute("@clip")});document.querySelectorAll("[\\@progress-min]").forEach(e=>{let t=Number(e.getAttribute("@progress-min")),r=Number(e.getAttribute("@progress-max")),o=Number(e.getAttribute("@progress-val")),n=e.getAttribute("@progress-color"),a=e.getAttribute("@progress-bg"),i=e.getAttribute("@progress-height");if(r<=t)return;let s=(o-t)/(r-t)*100;e.style.setProperty("--progress",s+"%"),e.style.setProperty("--color",n),e.style.setProperty("--background",a),e.style.setProperty("--height",i),e.removeAttribute("@progress-min"),e.removeAttribute("@progress-max"),e.removeAttribute("@progress-val")});document.querySelectorAll(".range").forEach(e=>{let t=e.getAttribute("@range-color"),r=e.getAttribute("@range-bg");e.style.setProperty("--range-color",t),e.style.setProperty("--range-bg",r)});function H(e=document.body){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),r=[];for(;t.nextNode();)r.push(t.currentNode);r.forEach(n=>{let a=n.textContent.trim();if(["@cycle","@endcycle","@stop","@resume"].some(s=>a.startsWith(s))){let s=document.createComment(a);n.parentNode.replaceChild(s,n)}});let o=Array.from(e.querySelectorAll("*")).flatMap(n=>Array.from(n.childNodes));for(let n of o)if(n.nodeType===Node.COMMENT_NODE&&n.textContent.trim().startsWith("@cycle")){let a=n.textContent.match(/@cycle\s+(\w+)\s+in\s+(\w+)/);if(!a)continue;let[i,s,l]=a,c=window[l];if(!c||!Array.isArray(c))continue;let u=n.parentNode,f=[],m=n.nextSibling;for(;m&&!(m.nodeType===Node.COMMENT_NODE&&m.textContent.trim().startsWith("@endcycle"));)f.push(m),m=m.nextSibling;let b=m,w=[];e:for(let d=0;d<c.length;d++){let A=c[d],E=document.createDocumentFragment(),N=!1;for(let p of f){if(p.nodeType===Node.COMMENT_NODE&&p.textContent.trim().startsWith("@resume")){let h=p.textContent.match(/@resume\((.+)\)/)?.[1];if(h)try{if(new Function(s,"index","array","Math",`return ${h};`)(A,d,c,Math)){N=!0;break}}catch(g){console.error("Error in @resume:",h,g)}continue}if(p.nodeType===Node.COMMENT_NODE&&p.textContent.trim().startsWith("@stop")){let h=p.textContent.match(/@stop\((.+)\)/)?.[1];if(h)try{if(new Function(s,"index","array","Math",`return ${h};`)(A,d,c,Math))break e}catch(g){console.error("Error in @stop:",h,g)}continue}let M=p.cloneNode(!0);L(M,s,A,d,c)&&E.appendChild(M)}N||E.hasChildNodes()&&w.push(E)}f.forEach(d=>d.remove()),w.forEach(d=>u.insertBefore(d,b)),n.remove(),b&&b.remove()}}function L(e,t,r,o,n){if(e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute("@if")){let a=e.getAttribute("@if");try{if(!new Function(t,"index","array","Math",`return ${a};`)(r,o,n,Math))return!1}catch(i){return console.error("Error in @if:",a,i),!1}e.removeAttribute("@if")}return e.nodeType===Node.TEXT_NODE?e.textContent=e.textContent.replace(/@\{([^}]+)\}/g,(a,i)=>{try{return new Function(t,"index","array","Math",`return ${i};`)(r,o,n,Math)}catch(s){return console.error("Expression error:",i,s),""}}):e.nodeType===Node.ELEMENT_NODE&&Array.from(e.childNodes).forEach(a=>{L(a,t,r,o,n)}),!0}function I(e=document.body){function t(r){if(r.nodeType!==Node.TEXT_NODE){if(r.innerHTML&&r.innerHTML.includes("@repeat")){let o=/@repeat\((\d+)\)([\s\S]*?)@endrepeat/g,n=r.innerHTML,a;for(;(a=o.exec(n))!==null;){let i=parseInt(a[1],10),s=a[2],l="";for(let c=0;c<i;c++)l+=s.replace(/@{index}/g,c);n=n.replace(a[0],l),o.lastIndex=0}r.innerHTML=n}r.childNodes.forEach(o=>t(o))}}t(e)}document.addEventListener("DOMContentLoaded",()=>H());document.addEventListener("DOMContentLoaded",()=>I());document.querySelectorAll(".dropdown-toggle").forEach(e=>{e.addEventListener("click",t=>{let r=e.parentElement;r&&r.classList.toggle("show")})});document.addEventListener("click",e=>{document.querySelectorAll(".dropdown").forEach(t=>{t.contains(e.target)||t.classList.remove("show")})});function S(e,t){return t.split(".").reduce((r,o)=>r?r[o]:void 0,e)}document.querySelectorAll("[\\@fetch]").forEach(async e=>{let t=e.getAttribute("@fetch");if(t){try{let o=await(await fetch(t)).json(),n=e.getAttribute("@iterate")||"all",a=[];if(Array.isArray(o)){if(n||(n="all"),n.startsWith("filter:")){let l=n.slice(7).trim();a=o.map((c,u)=>({item:c,index:u})).filter(({item:c,index:u})=>{try{return new Function("item","index",`return ${l}`)(c,u)}catch(f){return console.error("Error in filter expression:",l,f),!1}}).map(({index:c})=>c)}else switch(n){case"all":a=Array.from(o.keys());break;case"first":a=[0];break;case"last":a=[o.length-1];break;case"odd":a=o.map((l,c)=>c).filter(l=>l%2!==0);break;case"even":a=o.map((l,c)=>c).filter(l=>l%2===0);break;default:if(/^\d+$/.test(n))a=Array.from({length:Math.min(Number(n),o.length)},(l,c)=>c);else if(/^range:(\d+)-(\d+)$/.test(n)){let[,l,c]=n.match(/^range:(\d+)-(\d+)$/);a=Array.from({length:c-l+1},(u,f)=>parseInt(l)+f).filter(u=>u<o.length)}else a=[0];break}let i=e.innerHTML,s="";a.forEach(l=>{let c=o[l],u=i;u=u.replace(/@fetch\.([\w\d_.-]+)/g,(f,m)=>S(c,m)??""),s+=u}),e.innerHTML=s}else e.querySelectorAll("*").forEach(i=>{i.childNodes.forEach(s=>{s.nodeType===Node.TEXT_NODE&&(s.textContent=s.textContent.replace(/@fetch\.([\w\d_.-]+)/g,(l,c)=>S(o,c)??""))})})}catch(r){console.error("Fetch failed:",r),e.textContent="\u26A0 Fetch error"}e.removeAttribute("@fetch"),e.removeAttribute("@iterate")}});var x=class{element;constructor(t){this.element=document.querySelectorAll(t)}fadeIn(t=1e3,r=0){this.element.forEach(o=>{setTimeout(()=>{o instanceof HTMLElement&&(o.style.transition=`opacity ${t}ms`,o.style.opacity="1")},r)})}};window.Butterfly=x;})();
